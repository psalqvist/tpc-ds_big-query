{"kind":"bigquery#job","etag":"sLA0SSI6aOQMYpg/I6BI+g==","id":"elite-fabric-384711:US.query4_1683621216","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/elite-fabric-384711/jobs/query4_1683621216?location=US","user_email":"salqvist.philip@gmail.com","configuration":{"query":{"query":"-- query4\nWITH year_total \n AS (SELECT c_customer_id customer_id, \n d_year dyear, \n Sum(( ( ss_ext_list_price - ss_ext_wholesale_cost \n - ss_ext_discount_amt \n ) \n + \n ss_ext_sales_price ) / 2) year_total, \n 's' sale_type \n FROM customer, \n store_sales, \n date_dim \n WHERE c_customer_sk = ss_customer_sk \n AND ss_sold_date_sk = d_date_sk \n GROUP BY c_customer_id, \n d_year \n UNION ALL \n SELECT c_customer_id customer_id, \n d_year dyear, \n Sum(( ( ( cs_ext_list_price \n - cs_ext_wholesale_cost \n - cs_ext_discount_amt \n ) + \n cs_ext_sales_price ) / 2 )) year_total, \n 'c' sale_type \n FROM customer, \n catalog_sales, \n date_dim \n WHERE c_customer_sk = cs_bill_customer_sk \n AND cs_sold_date_sk = d_date_sk \n GROUP BY c_customer_id, \n d_year \n UNION ALL \n SELECT c_customer_id customer_id, \n d_year dyear, \n Sum(( ( ( ws_ext_list_price \n - ws_ext_wholesale_cost \n - ws_ext_discount_amt \n ) + \n ws_ext_sales_price ) / 2 )) year_total, \n 'w' sale_type \n FROM customer, \n web_sales, \n date_dim \n WHERE c_customer_sk = ws_bill_customer_sk \n AND ws_sold_date_sk = d_date_sk \n GROUP BY c_customer_id, \n d_year) \nSELECT t_s_secyear.customer_id, \n customer.c_first_name, \n customer.c_last_name, \n customer.c_preferred_cust_flag \nFROM year_total t_s_firstyear, \n year_total t_s_secyear, \n year_total t_c_firstyear, \n year_total t_c_secyear, \n year_total t_w_firstyear, \n year_total t_w_secyear,\n customer\nWHERE t_s_secyear.customer_id = t_s_firstyear.customer_id \n AND t_s_firstyear.customer_id = t_c_secyear.customer_id \n AND t_s_firstyear.customer_id = t_c_firstyear.customer_id \n AND t_s_firstyear.customer_id = t_w_firstyear.customer_id \n AND t_s_firstyear.customer_id = t_w_secyear.customer_id \n AND t_s_secyear.customer_id = customer.c_customer_id\n AND t_s_firstyear.sale_type = 's' \n AND t_c_firstyear.sale_type = 'c' \n AND t_w_firstyear.sale_type = 'w' \n AND t_s_secyear.sale_type = 's' \n AND t_c_secyear.sale_type = 'c' \n AND t_w_secyear.sale_type = 'w' \n AND t_s_firstyear.dyear = 2001 \n AND t_s_secyear.dyear = 2001 + 1 \n AND t_c_firstyear.dyear = 2001 \n AND t_c_secyear.dyear = 2001 + 1 \n AND t_w_firstyear.dyear = 2001 \n AND t_w_secyear.dyear = 2001 + 1 \n AND t_s_firstyear.year_total > 0 \n AND t_c_firstyear.year_total > 0 \n AND t_w_firstyear.year_total > 0 \n AND CASE \n WHEN t_c_firstyear.year_total > 0 THEN t_c_secyear.year_total / \n t_c_firstyear.year_total \n ELSE NULL \n END > CASE \n WHEN t_s_firstyear.year_total > 0 THEN \n t_s_secyear.year_total / \n t_s_firstyear.year_total \n ELSE NULL \n END \n AND CASE \n WHEN t_c_firstyear.year_total > 0 THEN t_c_secyear.year_total / \n t_c_firstyear.year_total \n ELSE NULL \n END > CASE \n WHEN t_w_firstyear.year_total > 0 THEN \n t_w_secyear.year_total / \n t_w_firstyear.year_total \n ELSE NULL \n END \nORDER BY t_s_secyear.customer_id\nLIMIT 100; \n","destinationTable":{"projectId":"elite-fabric-384711","datasetId":"_3d6f639f1945a8d62dc8435595371d8a0b51c19a","tableId":"anon92199755b4d235451236668b73820bb90419f890bddd658aa8842b51bea57216"},"writeDisposition":"WRITE_TRUNCATE","defaultDataset":{"datasetId":"scale_1","projectId":"elite-fabric-384711"},"priority":"INTERACTIVE","maximumBillingTier":10,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"elite-fabric-384711","jobId":"query4_1683621216","location":"US"},"statistics":{"creationTime":"1683621216937","startTime":"1683621217028","endTime":"1683621217216","totalBytesProcessed":"0","query":{"totalBytesProcessed":"0","totalBytesBilled":"0","cacheHit":true,"statementType":"SELECT"}},"status":{"state":"DONE"},"principal_subject":"user:salqvist.philip@gmail.com"}
