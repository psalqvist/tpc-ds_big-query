{"kind":"bigquery#job","etag":"7iEbTHyoPuiSmWF9mD1WTg==","id":"elite-fabric-384711:US.query49_1683621324","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/elite-fabric-384711/jobs/query49_1683621324?location=US","user_email":"salqvist.philip@gmail.com","configuration":{"query":{"query":"-- query49\nSELECT 'web' AS channel, \n web.item, \n web.return_ratio, \n web.return_rank, \n web.currency_rank \nFROM (SELECT item, \n return_ratio, \n currency_ratio, \n Rank() \n OVER ( \n ORDER BY return_ratio) AS return_rank, \n Rank() \n OVER ( \n ORDER BY currency_ratio) AS currency_rank \n FROM (SELECT ws.ws_item_sk AS item, \n ( Sum(COALESCE(wr.wr_return_quantity, 0)) / \n Sum(COALESCE(ws.ws_quantity, 0)) ) AS \n return_ratio, \n ( Sum(COALESCE(wr.wr_return_amt, 0)) / \n Sum(COALESCE(ws.ws_net_paid, 0)) ) AS currency_ratio \n FROM web_sales ws \n LEFT OUTER JOIN web_returns wr \n ON ( ws.ws_order_number = wr.wr_order_number \n AND ws.ws_item_sk = wr.wr_item_sk ), \n date_dim \n WHERE wr.wr_return_amt > 10000 \n AND ws.ws_net_profit > 1 \n AND ws.ws_net_paid > 0 \n AND ws.ws_quantity > 0 \n AND ws_sold_date_sk = d_date_sk \n AND d_year = 1999 \n AND d_moy = 12 \n GROUP BY ws.ws_item_sk) in_web) web \nWHERE ( web.return_rank <= 10 \n OR web.currency_rank <= 10 ) \nUNION ALL \nSELECT 'catalog' AS channel, \n catalog.item, \n catalog.return_ratio, \n catalog.return_rank, \n catalog.currency_rank \nFROM (SELECT item, \n return_ratio, \n currency_ratio, \n Rank() \n OVER ( \n ORDER BY return_ratio) AS return_rank, \n Rank() \n OVER ( \n ORDER BY currency_ratio) AS currency_rank \n FROM (SELECT cs.cs_item_sk AS \n item, \n ( Sum(COALESCE(cr.cr_return_quantity, 0)) / \n Sum(COALESCE(cs.cs_quantity, 0)) ) AS \n return_ratio, \n ( Sum(COALESCE(cr.cr_return_amount, 0)) / \n Sum(COALESCE(cs.cs_net_paid, 0)) ) AS \n currency_ratio \n FROM catalog_sales cs \n LEFT OUTER JOIN catalog_returns cr \n ON ( cs.cs_order_number = cr.cr_order_number \n AND cs.cs_item_sk = cr.cr_item_sk ), \n date_dim \n WHERE cr.cr_return_amount > 10000 \n AND cs.cs_net_profit > 1 \n AND cs.cs_net_paid > 0 \n AND cs.cs_quantity > 0 \n AND cs_sold_date_sk = d_date_sk \n AND d_year = 1999 \n AND d_moy = 12 \n GROUP BY cs.cs_item_sk) in_cat) catalog \nWHERE ( catalog.return_rank <= 10 \n OR catalog.currency_rank <= 10 ) \nUNION ALL\nSELECT 'store' AS channel, \n store.item, \n store.return_ratio, \n store.return_rank, \n store.currency_rank \nFROM (SELECT item, \n return_ratio, \n currency_ratio, \n Rank() \n OVER ( \n ORDER BY return_ratio) AS return_rank, \n Rank() \n OVER ( \n ORDER BY currency_ratio) AS currency_rank \n FROM (SELECT sts.ss_item_sk AS \n item, \n ( Sum(COALESCE(sr.sr_return_quantity, 0)) / \n Sum(COALESCE(sts.ss_quantity, 0)) ) AS \n return_ratio, \n ( Sum(COALESCE(sr.sr_return_amt, 0)) \n / Sum(COALESCE(sts.ss_net_paid, 0)) ) AS \n currency_ratio \n FROM store_sales sts \n LEFT OUTER JOIN store_returns sr \n ON ( sts.ss_ticket_number = \n sr.sr_ticket_number \n AND sts.ss_item_sk = sr.sr_item_sk ), \n date_dim \n WHERE sr.sr_return_amt > 10000 \n AND sts.ss_net_profit > 1 \n AND sts.ss_net_paid > 0 \n AND sts.ss_quantity > 0 \n AND ss_sold_date_sk = d_date_sk \n AND d_year = 1999 \n AND d_moy = 12 \n GROUP BY sts.ss_item_sk) in_store) store \nWHERE ( store.return_rank <= 10 \n OR store.currency_rank <= 10 ) \nORDER BY 1, \n 4, \n 5\nLIMIT 100; \n","destinationTable":{"projectId":"elite-fabric-384711","datasetId":"_3d6f639f1945a8d62dc8435595371d8a0b51c19a","tableId":"anonc7dda729c314149b86ff795315e2fa6cffab096b92e5b03456bdef52130ca3d1"},"writeDisposition":"WRITE_TRUNCATE","defaultDataset":{"datasetId":"scale_1","projectId":"elite-fabric-384711"},"priority":"INTERACTIVE","maximumBillingTier":10,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"elite-fabric-384711","jobId":"query49_1683621324","location":"US"},"statistics":{"creationTime":"1683621325051","startTime":"1683621325160","endTime":"1683621325314","totalBytesProcessed":"0","query":{"totalBytesProcessed":"0","totalBytesBilled":"0","cacheHit":true,"statementType":"SELECT"}},"status":{"state":"DONE"},"principal_subject":"user:salqvist.philip@gmail.com"}
